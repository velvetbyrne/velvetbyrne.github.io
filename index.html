<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Suit Database - GitHub Pages</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Mobile Suit Database</h1>
        </header>
        
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search..." id="searchInput">
            <div class="results-count" id="resultsCount"></div>
        </div>

        <div class="gallery-container">
            <div class="gallery" id="gallery">
            </div>
            <div class="no-results" id="noResults">
                No mobile suits found matching your search.
            </div>
        </div>
    </div>

    <script>
        let mobileSuits = [];
        async function loadMobileSuits() {
            const response = await fetch('mobile-suits.json');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            mobileSuits = await response.json();
            console.log('Mobile suits data loaded successfully');
            return mobileSuits;
        }

        function createGalleryItem(suit) {
            const item = document.createElement('div');
            item.className = 'gallery-item';
            item.setAttribute('data-searchable', `${suit.modelCode} ${suit.name}`.toLowerCase());
            
            const modelCodeHtml = suit.modelCode 
                ? `<div class="model-code">${suit.modelCode}</div>`
                : '';
            
            const suitNameClass = suit.modelCode ? 'suit-name' : 'suit-name no-code';
            
            item.innerHTML = `
                <div class="image-container">
                    <img src="img/${suit.image}" alt="${suit.name}" onerror="this.src='img/placeholder/nopic.png'">
                </div>
                <div class="caption">
                    ${modelCodeHtml}
                    <div class="${suitNameClass}">${suit.name}</div>
                </div>
            `;
            
            return item;
        }

        function populateGallery() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            
            mobileSuits.forEach(suit => {
                gallery.appendChild(createGalleryItem(suit));
            });
            
            updateResultsCount();
        }

        function filterGallery(searchTerm) {
            const items = document.querySelectorAll('.gallery-item');
            const noResults = document.getElementById('noResults');
            let visibleCount = 0;
            
            items.forEach(item => {
                const searchableText = item.getAttribute('data-searchable');
                const isMatch = searchableText.includes(searchTerm.toLowerCase());
                
                if (isMatch) {
                    item.classList.remove('hidden');
                    visibleCount++;
                } else {
                    item.classList.add('hidden');
                }
            });
            
            if (visibleCount === 0 && searchTerm.trim() !== '') {
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
            }
            
            updateResultsCount(visibleCount, searchTerm);
        }

        function updateResultsCount(visibleCount = null, searchTerm = '') {
            const resultsCount = document.getElementById('resultsCount');
            const totalCount = mobileSuits.length;
            
            if (visibleCount === null) {
                visibleCount = totalCount;
            }
            
            if (searchTerm.trim() === '') {
                resultsCount.textContent = `Showing all ${totalCount} mobile suits`;
            } else {
                resultsCount.textContent = `Showing ${visibleCount} of ${totalCount} mobile suits`;
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            await loadMobileSuits();
            
            populateGallery();
            
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                filterGallery(this.value);
            });
            
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    this.value = '';
                    filterGallery('');
                    this.blur();
                }
            });
        });
    </script>
</body>
</html>